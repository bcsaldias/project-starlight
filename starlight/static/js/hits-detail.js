// Generated by CoffeeScript 1.10.0
$(function() {
  var hits_id, url;
  hits_id = $('#hits_id').attr('data-value');
  url = '/hits/' + hits_id + '/data';
  $.getJSON(url, function(result) {
    var datapoint, err, i, lcdata, len, lightcurve, mag, mag_mean, mag_std, mjd, periodLS, period_fit, profile;
    $("#vote").removeAttr("hidden");
    profile = JSON.parse(result['profile'])[0];
    lightcurve = JSON.parse(result['lightcurve']);
    periodLS = profile['fields']['periodLS'];
    $("#periodLS").attr('data-value', periodLS);
    $("#periodLS").text(periodLS.toFixed(5));
    period_fit = profile['fields']['period_fit'];
    $("#period_fit").attr('data-value', period_fit);
    $("#period_fit").text(period_fit.toFixed(5));
    mag_mean = profile['fields']['mag_mean'];
    $("#mag_mean").attr('data-value', mag_mean);
    $("#mag_mean").text(mag_mean.toFixed(5));
    mag_std = profile['fields']['mag_std'];
    $("#mag_std").attr('data-value', mag_std);
    $("#mag_std").text(mag_std.toFixed(5));
    mjd = Array();
    mag = Array();
    err = Array();
    for (i = 0, len = lightcurve.length; i < len; i++) {
      datapoint = lightcurve[i];
      mjd.push(datapoint['fields']['mjd']);
      mag.push(datapoint['fields']['mag']);
      err.push(datapoint['fields']['err']);
    }
    lcdata = {
      mjd: mjd,
      mag: mag,
      err: err
    };
    mainPlot(lcdata);
    return foldPlot(lcdata, periodLS);
  });
  return $("#vote").click(function(e) {
    var label;
    e.preventDefault();
    label = $("#select-star").find(':selected').val();
    url = '/hits/' + hits_id + '/';
    return $.post(url, {
      'label': label
    }, function(result) {
      var new_url, next, point;
      next = result['next'];
      point = result['point'];
      if (point >= 1) {
        point = "+" + point;
        new_url = '/hits/' + next + '/';
        return $("#point").text(point).removeAttr('hidden').animate({
          bottom: '150px',
          opacity: '0.0'
        }, 750, function() {
          window.history.pushState({}, hits_id, url);
          return window.location.replace(new_url);
        });
      } else {
        new_url = '/hits/' + next + '/';
        window.history.pushState({}, hits_id, url);
        return window.location.replace(new_url);
      }
    });
  });
});
