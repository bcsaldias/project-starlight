// Generated by CoffeeScript 1.10.0
$(function() {
  var hits_id, url;
  hits_id = $('#hits_id').attr('data-value');
  PeriodLS = $('#PeriodLS').attr('data-value');
});

$(function(){
 $("#ceph_button").click(function(e) {
    post_full_vote("CEP","abc");
  });
});
$(function(){
 $("#eb_button").click(function(e) {
    post_full_vote("EB","abc");
  });
});
$(function(){
 $("#lpv_button").click(function(e) {
    post_full_vote("LPV","abc");
  });
});
$(function(){
 $("#rrl_button").click(function(e) {
    post_full_vote("RRLYR","abc");
  });
});

$(function(){
 $("#yes_button").click(function(e) {
    post_vote($('#private_question').attr('data-value'), true,
      $('#question_type').attr('data-value')
      );
  });
 
});

$(function(){
 $("#no_button").click(function(e) {
    post_vote($('#private_question').attr('data-value'), false,
      $('#question_type').attr('data-value')
      );
  });
 
});

function post_full_vote(vote, question_type) {

    var hits_id, url;
    hits_id = $('#hits_id').attr('data-value');
    url = '/hits/' + hits_id + '/';
    
    return $.post(url, {
      'value': vote,
      'question_type': question_type,
      'milliseconds': beforeunload
    }, function(result) {
      var new_url, next, point;
      next = result['next'];
      new_url = '/hits/' + next + '/';
      window.history.pushState({}, hits_id, url);
      return window.location.replace(new_url);
    
    })

}

function post_vote(question, vote, question_type) {
    var hits_id, url;
    hits_id = $('#hits_id').attr('data-value');
    url = '/hits/' + hits_id + '/';
    
    return $.post(url, {
      'value': vote,
      'private_question': question,
      'question_type': question_type,
      'milliseconds': beforeunload()
    }, function(result) {
      var new_url, next, point;
      next = result['next'];
      new_url = '/hits/' + next + '/';
      window.history.pushState({}, hits_id, url);
      return window.location.replace(new_url);
    
    })
}

document.onkeydown = checkKey;

function checkKey(e) {

    question_type = $('#question_type').attr('data-value');

    if (question_type == 'yn'){
          e = e || window.event;
          if (e.keyCode == '89'|| e.keyCode == '39') {
              //console.log("yes");
              post_vote($('#private_question').attr('data-value'), true,
              $('#question_type').attr('data-value')
              );

          }
          else if (e.keyCode == '78' || e.keyCode == '37') {
              //console.log("no");
              post_vote($('#private_question').attr('data-value'), false,
              $('#question_type').attr('data-value')
              );
          }

    }


}

$(window).scroll(function(){
  $("#star-info").css({"margin-top": ($(window).scrollTop()) + "px"});
});

/*
      point = result['point'];
      if (point >= 1) {
        point = "+" + point;
        new_url = '/hits/' + next + '/';
        return $("#point").text(point).removeAttr('hidden').animate({
          bottom: '150px',
          opacity: '0.0'
        }, 750, function() {
          window.history.pushState({}, hits_id, url);
          return window.location.replace(new_url);
        });
      } else {
*/

let startDate = new Date();
let elapsedTime = 0;

const focus = function() {
    startDate = new Date();
};

/*const blur = function() {
    const endDate = new Date();
    const spentTime = endDate.getTime() - startDate.getTime();
    elapsedTime += spentTime;
};*/

const beforeunload = function() {
    const endDate = new Date();
    const spentTime = endDate.getTime() - startDate.getTime();
    elapsedTime += spentTime;
    return elapsedTime;
    //console.log("spent time", elapsedTime/1000);
    // elapsedTime contains the time spent on page in milliseconds
};

window.addEventListener('onLoad', focus);
//window.addEventListener('focus', focus);
//window.addEventListener('blur', blur);
//window.addEventListener('beforeunload', beforeunload);